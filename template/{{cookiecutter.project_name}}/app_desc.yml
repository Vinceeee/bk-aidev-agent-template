spec_version: 2
modules:
  default:
    language: python
    is_default: true
    processes:
      web:
        command: gunicorn bk_plugin_runtime.wsgi --timeout 120 -k gthread -w 2 --max-requests=1000 --threads 64
    env_variables:
      - key: PIP_VERSION
        value: 21.0
        description: pip version control
      - key: BK_APIGW_MANAGER_URL_TMPL
        value: {{cookiecutter.apigw_manager_url_tmpl}}
        description: pip version control
      - key: BK_APIGW_MANAGER_MAINTAINERS
        value: {{cookiecutter.init_apigw_maintainer}}
        description: plugin apigw managers
      - key: BK_INIT_SUPERUSER
        value: {{cookiecutter.init_admin}}
        description: plugin admin panel init superuser
      - key: BK_SOPS_APP_CODE
        value: bksops
        description: bk-sops app code
      - key: DJANGO_SETTINGS_MODULE
        value: aidev.core.conf.plugin
        description: django settings module path
      - key: BK_APP_CONFIG_PATH
        value: bk_plugin_runtime.config
        description: blueapps config path
      - key: BK_APIGW_CORS_ALLOW_ORIGINS
        value: {{cookiecutter.apigw_cors_allow_origins}}
        description: apigw cors strategie allow origins
      - key: BK_APIGW_CORS_ALLOW_METHODS
        value: {{cookiecutter.apigw_cors_allow_methods}}
        description: apigw cors strategie allow methods
      - key: BK_APIGW_CORS_ALLOW_HEADERS
        value: {{cookiecutter.apigw_cors_allow_headers}}
        description: apigw cors strategie allow headers
      - key: DJANGO_ALLOW_ASYNC_UNSAFE
        value: "True"
        description: set django allow unsafe async
      - key: LLM_GATEWAY_URL
        value: "https://bkaidev.apigw.o.woa.com/prod/openapi/aidev/gateway/llm/v1/"
        description: LLM gateway endpoint
      - key: MODEL_MANAGEMENT_NS_HOST
        value: ds-nameserver.bkaidev.woa.com
        description: model management host
      - key: MODEL_MANAGEMENT_NS_PORT
        value: 2830
        description: model management port
      - key: SIMILARITY_MODEL_SERVICE_NAME
        value: "model.self_host.similarity_model.SimilarityModel"
        description: similarity model service name
      - key: LLM_SERVICE_PREFIX
        value: "aiops_llm"
        description: LLM service prefix
  frontend:
    language: NodeJS
    source_dir: frontend
    processes:
      web:
        command: npm run server
